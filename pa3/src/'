#ifndef bstar__bstar_h
#define bstar__bstar_h

// #define BSTAR_DEBUG

#include "bstarGlobal.hpp"
#include "state.hpp"
#include "db/db.hpp"

class Bstar{
public:
    Bstar   (DB& db) : _db(db), _finalState(_db.blockSize()) {};

    void    solve           ();
    
    const Point&    finalSize   () { return _finalState.size(); }
private:
    struct BstarParam {
        float   startTemperature  = 1000000;
        float   numStepCoefficient = 10;
        float   gamma = 0.85;
        float   epsilon = 10;
        float   aspectRationCost = 10000000;
        float   aspectRationCostIncrememt = 1.0001;
        float   aspectRationCostDecrement = 0.9;
        float   quitCondition = 0.99;

    } bstarParam;

    void    initState       (State& state);
    void    perturbState    (State& state, PerturbSeed& seed);
    void    calculateCost   (State& state);

    Block&  block           (int i) { return _db.block(i); }
    void    randomPerturbSeed(State& state, PerturbSeed& seed);

    float   costWithRatio   (State& state);
    float   costWithoutRatio(State& state);
    bool    check           (State& state);


    DB&     _db;
    State   _finalState;
};


#endif

